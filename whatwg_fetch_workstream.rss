<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>WHATWG Fetch Workstream-relevant MDN issues</title>
        <link>https://dontcallmedom.github.io/mdn-issue-by-spec/whatwg_fetch_workstream.rss</link>
        <description>Issue filed on MDN Web Docs related to pages attached to technologies developed by WHATWG Fetch Workstream</description>
        <lastBuildDate>Tue, 16 Jan 2024 01:34:58 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[[fetch] Missing Request constructor duplex option]]></title>
            <link>https://github.com/mdn/content/issues/31735</link>
            <guid>https://github.com/mdn/content/issues/31735</guid>
            <pubDate>Tue, 16 Jan 2024 01:34:58 GMT</pubDate>
            <content:encoded><![CDATA[<h3 dir="auto">MDN URL</h3>
<p dir="auto"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/Request" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/Request/Request</a></p>
<h3 dir="auto">What specific section or headline is this issue about?</h3>
<p dir="auto">Parameters</p>
<h3 dir="auto">What information was incorrect, unhelpful, or incomplete?</h3>
<p dir="auto">The spec has a <code class="notranslate">duplex</code> option, but it's missing from the page</p>
<h3 dir="auto">What did you expect to see?</h3>
<p dir="auto">A note about the parameter, and that it needs to be set to <code class="notranslate">"half"</code> when using a <code class="notranslate">ReadableStream</code> body.</p>
<p dir="auto">It would also be nice to have a row for browser compatibility.</p>
<h3 dir="auto">Do you have any supporting links, references, or citations?</h3>
<p dir="auto">Spec: <a href="https://fetch.spec.whatwg.org/#request-class" rel="nofollow">https://fetch.spec.whatwg.org/#request-class</a><br>
Chrome docs (showing how to do half-duplex fetch): <a href="https://developer.chrome.com/docs/capabilities/web-apis/fetch-streaming-requests" rel="nofollow">https://developer.chrome.com/docs/capabilities/web-apis/fetch-streaming-requests</a><br>
Related web platform test: <a href="https://wpt.fyi/results/fetch/api/request/request-init-stream.any.html?label=master&amp;label=experimental&amp;aligned&amp;q=request-init-stream" rel="nofollow">https://wpt.fyi/results/fetch/api/request/request-init-stream.any.html?label=master&amp;label=experimental&amp;aligned&amp;q=request-init-stream</a></p>
<h3 dir="auto">Do you have anything more you want to share?</h3>
<p dir="auto">The <code class="notranslate">Request</code> class itself also has a <code class="notranslate">duplex</code> get-only property, so main page (<a href="https://developer.mozilla.org/en-US/docs/Web/API/Request" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/Request</a>) is affected and an instance property page is missing too</p>
<h3 dir="auto">MDN metadata</h3>

<details>
<summary>Page report details</summary>
<ul dir="auto">
<li>Folder: <code class="notranslate">en-us/web/api/request</code></li>
<li>MDN URL: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/Request</a></li>
<li>GitHub URL: <a href="https://github.com/mdn/content/blob/main/files/en-us/web/api/request/index.md">https://github.com/mdn/content/blob/main/files/en-us/web/api/request/index.md</a></li>
<li>Last commit: <a class="commit-link" data-hovercard-type="commit" data-hovercard-url="https://github.com/mdn/content/commit/261317e8b63f0e8923d38320639919569c4afe47/hovercard" href="https://github.com/mdn/content/commit/261317e8b63f0e8923d38320639919569c4afe47"><tt>261317e</tt></a></li>
<li>Document last modified: 2023-09-16T16:24:12.000Z</li>
</ul>
</details>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[fetch] `Response.text()` can throw a `TypeError`]]></title>
            <link>https://github.com/mdn/content/issues/24466</link>
            <guid>https://github.com/mdn/content/issues/24466</guid>
            <pubDate>Wed, 15 Feb 2023 16:35:17 GMT</pubDate>
            <content:encoded><![CDATA[<h3 dir="auto">MDN URL</h3>
<p dir="auto"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/text" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/Response/text</a></p>
<h3 dir="auto">What specific section or headline is this issue about?</h3>
<p dir="auto">Return value</p>
<h3 dir="auto">What information was incorrect, unhelpful, or incomplete?</h3>
<p dir="auto">It says that it returns "A Promise that resolves with a String."<br>
But in reality it's possible for this promise to reject with a TypeError.</p>
<h3 dir="auto">What did you expect to see?</h3>
<p dir="auto">Mentioning of the rejected promise similar to what's shown at <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch#exceptions" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/fetch#exceptions</a></p>
<h3 dir="auto">Do you have any supporting links, references, or citations?</h3>
<p dir="auto"><a href="https://fetch.spec.whatwg.org/#concept-body-consume-body" rel="nofollow">https://fetch.spec.whatwg.org/#concept-body-consume-body</a> mentions:</p>
<blockquote>
<p dir="auto">If object is <a href="https://fetch.spec.whatwg.org/#body-unusable" rel="nofollow">unusable</a>, then return <a href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" rel="nofollow">a promise rejected with</a> a <a href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" rel="nofollow">TypeError</a>.</p>
</blockquote>
<p dir="auto">which is called by <a href="https://fetch.spec.whatwg.org/#dom-body-text" rel="nofollow">https://fetch.spec.whatwg.org/#dom-body-text</a></p>
<h3 dir="auto">Do you have anything more you want to share?</h3>
<ul dir="auto">
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/arrayBuffer" rel="nofollow"><code class="notranslate">Response.arrayBuffer()</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/blob" rel="nofollow"><code class="notranslate">Response.blob()</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/formData" rel="nofollow"><code class="notranslate">Response.formData()</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/json" rel="nofollow"><code class="notranslate">Response.json()</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/text" rel="nofollow"><code class="notranslate">Response.text()</code></a></li>
</ul>
<p dir="auto">all refer to <a href="https://fetch.spec.whatwg.org/#concept-body-consume-body" rel="nofollow"><code class="notranslate">consume body</code></a> in the spec, and would benefit from similar documentation.</p>
<h3 dir="auto">MDN metadata</h3>

<details>
<summary>Page report details</summary>
<ul dir="auto">
<li>Folder: <code class="notranslate">en-us/web/api/response/text</code></li>
<li>MDN URL: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/text" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/Response/text</a></li>
<li>GitHub URL: <a href="https://github.com/mdn/content/blob/main/files/en-us/web/api/response/text/index.md">https://github.com/mdn/content/blob/main/files/en-us/web/api/response/text/index.md</a></li>
<li>Last commit: <a class="commit-link" data-hovercard-type="commit" data-hovercard-url="https://github.com/mdn/content/commit/16e398809d62247dbadc89ff4024a0ffa4781f0e/hovercard" href="https://github.com/mdn/content/commit/16e398809d62247dbadc89ff4024a0ffa4781f0e"><tt>16e3988</tt></a></li>
<li>Document last modified: 2022-09-13T06:27:50.000Z</li>
</ul>
</details>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[fetch] fetch could reject when 400 is returned]]></title>
            <link>https://github.com/mdn/content/issues/17115</link>
            <guid>https://github.com/mdn/content/issues/17115</guid>
            <pubDate>Wed, 08 Jun 2022 21:48:36 GMT</pubDate>
            <content:encoded><![CDATA[<h3 dir="auto">MDN URL</h3>
<p dir="auto"><a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/fetch</a></p>
<h3 dir="auto">What specific section or headline is this issue about?</h3>
<p dir="auto">Introduction and "Exceptions". At "Exceptions", the part about TypeError and the table listing all the reasons for it to happen. I didn't find anything that could justify my results in that list.</p>
<h3 dir="auto">What information was incorrect, unhelpful, or incomplete?</h3>
<blockquote>
<p dir="auto">A <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch" rel="nofollow">fetch()</a> promise only rejects when a network error is encountered (which is usually when there's a permissions issue or similar). A <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch" rel="nofollow">fetch()</a> promise does not reject on HTTP errors (404, etc.). Instead, a then() handler must check the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/ok" rel="nofollow">Response.ok</a> and/or <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/status" rel="nofollow">Response.status</a> properties.</p>
</blockquote>
<h3 dir="auto">What did you expect to see?</h3>
<p dir="auto">I was expecting to trigger the execution of my success callback inside <code class="notranslate">then()</code> since http errors 4xx and 5xx should not reject the fetch promise. Instead, the error callback was executed.</p>
<p dir="auto">It seems to me that the information in the fetch() and  Fetch API pages are incorrect or outdated. I've made some tests and found that fetch is indeed rejecting promises when 400 status code is returned. I didn't try other error codes.</p>
<h3 dir="auto">Do you have any supporting links, references, or citations?</h3>
<p dir="auto"><a href="https://stackoverflow.com/questions/45899931/typeerror-failed-to-fetch-trying-to-perform-an-post-request-on-api-hosted-on-he/72552340#72552340" rel="nofollow">https://stackoverflow.com/questions/45899931/typeerror-failed-to-fetch-trying-to-perform-an-post-request-on-api-hosted-on-he/72552340#72552340</a></p>
<p dir="auto"><a href="https://forum.freecodecamp.org/t/type-error-failed-to-fetch-when-using-fetch-api/456214/5" rel="nofollow">https://forum.freecodecamp.org/t/type-error-failed-to-fetch-when-using-fetch-api/456214/5</a></p>
<h3 dir="auto">Do you have anything more you want to share?</h3>
<p dir="auto">Here is my test:</p>
<ul dir="auto">
<li>Setup a server with some POST methods and respective OPTIONS methods to support preflight requests</li>
<li>Define some required field in the request body. If the request has the field, make your server return 200. Else, return 400.</li>
<li>Send a request with and without the field and check which callback is fired inside <code class="notranslate">then()</code>.</li>
</ul>
<p dir="auto">Request code example:</p>
<div class="highlight highlight-source-js notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="  function test_fetch(){
	  let message = JSON.stringify({
             // 'ids' is the expected field. Change it latter for 'id' or something else to see the error.
             ids: [1] 
	  })
  
	  fetch('http://your.api/get_data',{
		  method: 'post',
                  // Adding Content-Type header to enable preflight. 
                  // It's still not working even with normal(no-preflight) requests.
                  // To test with normal instead of preflight requests,
                  // remove the line below from the fetch options object and
                  // make sure your server can handle text/plain data or else
                  // you may face some error due to wrong parsing of request body.
		  headers: {'Content-Type': 'application/json'},
		  body: message
	  })
	  .then(data =&gt; console.log('success'),data =&gt; console.log('error'))
  }"><pre class="notranslate">  <span class="pl-k">function</span> <span class="pl-en">test_fetch</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">{</span>
	  <span class="pl-k">let</span> <span class="pl-s1">message</span> <span class="pl-c1">=</span> <span class="pl-c1">JSON</span><span class="pl-kos">.</span><span class="pl-en">stringify</span><span class="pl-kos">(</span><span class="pl-kos">{</span>
             <span class="pl-c">// 'ids' is the expected field. Change it latter for 'id' or something else to see the error.</span>
             <span class="pl-c1">ids</span>: <span class="pl-kos">[</span><span class="pl-c1">1</span><span class="pl-kos">]</span> 
	  <span class="pl-kos">}</span><span class="pl-kos">)</span>
  
	  <span class="pl-en">fetch</span><span class="pl-kos">(</span><span class="pl-s">'http://your.api/get_data'</span><span class="pl-kos">,</span><span class="pl-kos">{</span>
		  <span class="pl-c1">method</span>: <span class="pl-s">'post'</span><span class="pl-kos">,</span>
                  <span class="pl-c">// Adding Content-Type header to enable preflight. </span>
                  <span class="pl-c">// It's still not working even with normal(no-preflight) requests.</span>
                  <span class="pl-c">// To test with normal instead of preflight requests,</span>
                  <span class="pl-c">// remove the line below from the fetch options object and</span>
                  <span class="pl-c">// make sure your server can handle text/plain data or else</span>
                  <span class="pl-c">// you may face some error due to wrong parsing of request body.</span>
		  <span class="pl-c1">headers</span>: <span class="pl-kos">{</span><span class="pl-s">'Content-Type'</span>: <span class="pl-s">'application/json'</span><span class="pl-kos">}</span><span class="pl-kos">,</span>
		  <span class="pl-c1">body</span>: <span class="pl-s1">message</span>
	  <span class="pl-kos">}</span><span class="pl-kos">)</span>
	  <span class="pl-kos">.</span><span class="pl-en">then</span><span class="pl-kos">(</span><span class="pl-s1">data</span> <span class="pl-c1">=&gt;</span> <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'success'</span><span class="pl-kos">)</span><span class="pl-kos">,</span><span class="pl-s1">data</span> <span class="pl-c1">=&gt;</span> <span class="pl-smi">console</span><span class="pl-kos">.</span><span class="pl-en">log</span><span class="pl-kos">(</span><span class="pl-s">'error'</span><span class="pl-kos">)</span><span class="pl-kos">)</span>
  <span class="pl-kos">}</span></pre></div>
<p dir="auto">I've tested in <code class="notranslate">Chrome, version 102.0.5005.61 (Official Build) (64-bit)</code> and <code class="notranslate">Firefox, version 75.0 (64-bit)</code>. Got the same unexpected behaviour in both.</p>
<h3 dir="auto">MDN metadata</h3>

<details>
<summary>Page report details</summary>
<ul dir="auto">
<li>Folder: <code class="notranslate">en-us/web/api/fetch</code></li>
<li>MDN URL: <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/fetch</a></li>
<li>GitHub URL: <a href="https://github.com/mdn/content/blob/main/files/en-us/web/api/fetch/index.md">https://github.com/mdn/content/blob/main/files/en-us/web/api/fetch/index.md</a></li>
<li>Last commit: <a class="commit-link" data-hovercard-type="commit" data-hovercard-url="https://github.com/mdn/content/commit/196cc4ff3068a59b962a3fe1cbb960eb72ef542b/hovercard" href="https://github.com/mdn/content/commit/196cc4ff3068a59b962a3fe1cbb960eb72ef542b"><tt>196cc4f</tt></a></li>
<li>Document last modified: 2022-05-31T04:47:00.000Z</li>
</ul>
</details>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[fetch] Issue with "Response.json()": Possible exceptions not documented]]></title>
            <link>https://github.com/mdn/content/issues/13208</link>
            <guid>https://github.com/mdn/content/issues/13208</guid>
            <pubDate>Tue, 22 Feb 2022 13:11:28 GMT</pubDate>
            <content:encoded><![CDATA[<p dir="auto">MDN URL: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/json" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/Response/json</a></p>
<h4 dir="auto">What information was incorrect, unhelpful, or incomplete?</h4>
<p dir="auto">This function can raise exceptions, but these are not documented. Try using it on a response that is not actually JSON, e.g.</p>
<h4 dir="auto">Specific section or headline?</h4>
<p dir="auto">Exceptions</p>
<h4 dir="auto">What did you expect to see?</h4>
<p dir="auto">The list of possible exceptions and their causes. See the <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch#exceptions" rel="nofollow"><code class="notranslate">fetch</code></a> documentation for an example of a function that documents its exceptions well.</p>

<details>
<summary>MDN Content page report details</summary>
<ul dir="auto">
<li>Folder: <code class="notranslate">en-us/web/api/response/json</code></li>
<li>MDN URL: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/json" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/Response/json</a></li>
<li>GitHub URL: <a href="https://github.com/mdn/content/blob/main/files/en-us/web/api/response/json/index.md">https://github.com/mdn/content/blob/main/files/en-us/web/api/response/json/index.md</a></li>
<li>Last commit: <a class="commit-link" data-hovercard-type="commit" data-hovercard-url="https://github.com/mdn/content/commit/93ae23dec42bba9d71d6f1ed45668d8d26847e9c/hovercard" href="https://github.com/mdn/content/commit/93ae23dec42bba9d71d6f1ed45668d8d26847e9c"><tt>93ae23d</tt></a></li>
<li>Document last modified: 2022-02-18T09:26:54.000Z</li>
</ul>
</details>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[fetch] Content bug: Inaccurate explanation on request credentials]]></title>
            <link>https://github.com/mdn/content/issues/13063</link>
            <guid>https://github.com/mdn/content/issues/13063</guid>
            <pubDate>Thu, 17 Feb 2022 09:18:12 GMT</pubDate>
            <content:encoded><![CDATA[<h2 dir="auto">What page(s) did you find the problem on?</h2>
<ul dir="auto">
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/credentials" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/Request/credentials</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials</a></li>
</ul>
<h2 dir="auto">Specific page section or heading?</h2>
<ul dir="auto">
<li>Under Syntax &gt; Value for the request credentials page</li>
<li>The intro text for the Access-Control-Allow-Credentials page</li>
</ul>
<h2 dir="auto">What is the problem?</h2>
<p dir="auto">There are a few problems:</p>
<ol dir="auto">
<li>Explanation on credentials weren't accurate because Authorisation headers were sent regardless whether 'credentials' were set to <code class="notranslate">omit</code>, <code class="notranslate">same-origin</code>, or <code class="notranslate">include</code>.</li>
</ol>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/3607637/154285142-f0198862-7534-4f13-8cd8-1634f4ea7ddd.png"><img src="https://user-images.githubusercontent.com/3607637/154285142-f0198862-7534-4f13-8cd8-1634f4ea7ddd.png" alt="FLsiY4PVQAIMy9r" style="max-width: 100%;"></a></p>
<ol start="2" dir="auto">
<li>The <code class="notranslate">Access-Control-Allow-Credentials</code> page mentioned that credentials are cookies, authorization headers, or TLS client certificates.</li>
</ol>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/3607637/154286505-56304bc9-ee6b-4d49-ae71-1efaa7b6b3c9.png"><img src="https://user-images.githubusercontent.com/3607637/154286505-56304bc9-ee6b-4d49-ae71-1efaa7b6b3c9.png" alt="CleanShot 2022-02-16 at 22 34 26" style="max-width: 100%;"></a></p>
<p dir="auto">A few things here:</p>
<ol dir="auto">
<li><code class="notranslate">Access-Control-Allow-Credentials</code> are not required for Authorization headers. They can be sent regardless whether <code class="notranslate">Access-Control-Allow-Credentials</code> is present.</li>
<li>Authorization headers only need <code class="notranslate">Authorization</code> to be included <code class="notranslate">Access-Control-Allowed-Headers</code>.</li>
<li><code class="notranslate">Access-Control-Allow-Credentials</code> are not required to send cookies between domains and subdomains. This is not listed anywhere but I thought it'll be good to make things clear.</li>
</ol>
<h2 dir="auto">What did you expect to see?</h2>
<p dir="auto">Three things:</p>
<ol dir="auto">
<li>I recommend removing "basic http auth" from the request credentials page since it doesn't look correct.</li>
<li>I recommend updating the pages to reflect a more accurate understanding for Access-Control-Allow-Credentials. Not sure what to update at this point, but I can take a stab at it.</li>
<li>Maybe we can point the "etc" part in Request Credentials page to the Access-Control-Allow-Credentials page because they seem linked. I'm not sure whether this is accurate though.</li>
</ol>
<h2 dir="auto">Did you test this? If so, how?</h2>
<p dir="auto">I tested <code class="notranslate">credentials</code> and wrote <a href="https://zellwk.com/blog/how-fetch-credentials-handles-cookies/" rel="nofollow">an article</a> about my tests. I focused on cookies in this article and didn't include the Authorization header parts. There's a test repository included in the article. I can create a test repo for the authorization part if necessary. Just let me know.</p>]]></content:encoded>
        </item>
    </channel>
</rss>